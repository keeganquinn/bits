---
- name: Add jenkins APT key
  become: yes
  apt_key:
    url: https://pkg.jenkins.io/debian-stable/jenkins.io.key
    state: present
  when: ansible_architecture == 'x86_64'

- name: Add multimedia APT key
  become: yes
  apt_key:
    keyserver: keyserver.ubuntu.com
    id: 5C808C2B65558117

- name: Add nodesource APT key
  become: yes
  apt_key:
    url: https://deb.nodesource.com/gpgkey/nodesource.gpg.key
    state: present
  when: ansible_architecture == 'x86_64'

- name: Add quinn.tk APT key
  become: yes
  apt_key:
    url: https://xmit.quinn.tk/debian/repo.gpg.key
    state: present

- name: Add yarn APT key
  become: yes
  apt_key:
    url: https://dl.yarnpkg.com/debian/pubkey.gpg
    state: present
  when: ansible_architecture == 'x86_64'

- name: Copy APT sources
  become: yes
  copy: src='sources.list.{{ ansible_architecture }}' dest=/etc/apt/sources.list

- name: Upgrade packages
  become: yes
  apt: update_cache=yes upgrade=dist

- name: Install machine packages
  become: yes
  apt:
    state: present
    name:
      - aide
      - apt-listchanges
      - bind9utils
      - curl
      - deborphan
      - dos2unix
      - emacs
      - figlet
      - file
      - finger
      - fonts-hack
      - git
      - lftp
      - logcheck
      - mlocate
      - nextcloud-desktop-cmd
      - nmap
      - p7zip
      - postfix
      - rkhunter
      - rsync
      - screen
      - sox
      - sshguard
      - tcpdump
      - unrar
      - unzip

- name: Copy aide default file
  become: yes
  copy: src=aide.default dest=/etc/default/aide

- name: Copy aide local configuration fragment
  become: yes
  copy: src=aide.local dest=/etc/aide/aide.conf.d/80_aide_local

- name: Copy logcheck configuration file
  become: yes
  copy: src=logcheck.conf dest=/etc/logcheck/logcheck.conf

- name: Copy logcheck local ignore file
  become: yes
  copy: src=logcheck.local dest=/etc/logcheck/ignore.d.server/local

- name: Copy rkhunter default file
  become: yes
  copy: src=rkhunter dest=/etc/default/rkhunter

- name: Copy sshguard whitelist file
  become: yes
  copy: src=whitelist dest=/etc/sshguard/whitelist
