---
- name: Install postfix package
  become: yes
  apt: name=postfix state=present

- name: Install procmail package
  become: yes
  apt: name=procmail state=present

- name: Copy hostname file
  become: yes
  copy:
    src: 'config/{{ ansible_hostname }}/hostname'
    dest: /etc/hostname

- name: Copy hosts file
  become: yes
  copy:
    src: 'config/{{ ansible_hostname }}/hosts'
    dest: /etc/hosts

- name: Copy mailname file
  become: yes
  copy:
    src: 'config/{{ ansible_hostname }}/mailname'
    dest: /etc/mailname

- name: Copy postfix main configuration
  become: yes
  copy:
    src: 'config/{{ ansible_hostname }}/postfix/main.cf'
    dest: /etc/postfix/main.cf
  notify: restart postfix

- name: Copy postfix master configuration
  become: yes
  copy:
    src: 'config/{{ ansible_hostname }}/postfix/master.cf'
    dest: /etc/postfix/master.cf
  notify: restart postfix

- name: Copy sasl smtpd configuration
  become: yes
  copy:
    src: 'config/{{ ansible_hostname }}/postfix/sasl-smtpd.conf'
    dest: /etc/postfix/sasl/smtpd.conf
  notify: restart postfix

- name: Copy postfix sasl_passwd file
  become: yes
  copy:
    src: 'config/{{ ansible_hostname }}/postfix/sasl_passwd'
    dest: /etc/postfix/sasl_passwd
    mode: 0600
  notify: rebuild postfix sasl_passwd

- name: Copy postfix virtual file
  become: yes
  copy:
    src: 'config/{{ ansible_hostname }}/postfix/virtual'
    dest: /etc/postfix/virtual
  notify: rebuild postfix virtual
