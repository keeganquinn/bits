---
- name: Install intranet packages
  become: yes
  apt:
    state: present
    name:
      - cups
      - docker-ce
      - dnsmasq
      - firmware-linux-nonfree
      - iftop
      - ipv6calc
      - jenkins
      - olsrd
      - openvpn
      - rsnapshot
      - zabbix-server-pgsql

- name: Copy cups configuration
  become: yes
  copy: src=cupsd.conf dest=/etc/cups/cupsd.conf

- name: Copy rsnapshot configuration
  become: yes
  copy: src=rsnapshot.conf dest=/etc/rsnapshot.conf

- name: Copy rsnapshot crontab
  become: yes
  copy: src=rsnapshot.cron dest=/etc/cron.d/rsnapshot

- name: Copy docker daemon configuration
  become: yes
  copy: src=docker-daemon.json dest=/etc/docker/daemon.json
  notify: restart docker

- name: Copy network interfaces
  become: yes
  copy: src=interfaces dest=/etc/network/interfaces

- name: Copy iptables rules
  become: yes
  copy: src=iptables.rules dest=/etc/network/iptables.rules

- name: Copy prefix_delegation script
  become: yes
  copy: src=prefix_delegation dest=/etc/dhcp/dhclient-exit-hooks.d/

- name: Copy sysctl.conf
  become: yes
  copy: src=sysctl.conf dest=/etc/sysctl.conf
  notify: reload sysctl

- name: Copy dnsmasq configuration
  become: yes
  copy: src=dnsmasq.conf dest=/etc/dnsmasq.conf
  notify: restart dnsmasq
