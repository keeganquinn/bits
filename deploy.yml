---
- name: Standard machine configuration
  hosts: servers

  roles:
    - machine
    - nameserver
    - email
    - webserver

- name: Zabbix agent
  hosts: servers

  tasks:
  - name: Install zabbix-agent package
    become: yes
    apt: name=zabbix-agent state=present

- name: Application server configuration
  hosts: scrap, len

  roles:
    - build
    - rails
    - palkan.phantomjs

- name: Organization services
  hosts: len

  roles:
    - listserv
    - redmine

- name: Creature comforts
  hosts: pi, scrap

  roles:
    - comfort

- name: Intranet configuration
  hosts: scrap

  roles:
    - intranet

- name: quinn.tk
  hosts: scrap, len

  tasks:
  - name: Create directory
    become: yes
    file:
      path: /srv/www/quinn.tk
      state: directory
      mode: 0755
      owner: '{{ ansible_user_uid }}'
      group: '{{ ansible_user_gid }}'

  - name: Sync site
    git:
      repo: scrap.quinn.tk:/srv/data/git/quinn.tk.git
      dest: /srv/www/quinn.tk
      version: master

- name: basslin.es
  hosts: len

  tasks:
  - name: Create directory
    become: yes
    file:
      path: /srv/www/basslin.es
      state: directory
      mode: 0755
      owner: '{{ ansible_user_uid }}'
      group: '{{ ansible_user_gid }}'

  - name: Sync site
    git:
      repo: scrap.quinn.tk:/srv/data/git/basslin.es.git
      dest: /srv/www/basslin.es
      version: master
